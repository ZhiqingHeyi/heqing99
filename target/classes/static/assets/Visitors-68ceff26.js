import{_ as K,i as P,d as v,r as s,s as Q,o as C,c as W,b as _,a as t,w as o,E as g,g as d,v as Y,f as T,t as Z,x as ee,y as te}from"./index-2ad3cb15.js";const le={class:"visitors-container"},oe={class:"page-header"},ae={class:"pagination-container"},re={class:"dialog-footer"},se={__name:"Visitors",setup(ne){const n=P({visitorName:"",roomNumber:"",status:"",visitDate:null}),b=v(!1),S=v([{visitorName:"王五",phone:"13800138002",idCard:"110101199001011234",roomNumber:"301",guestName:"张三",visitPurpose:"探访亲友",startTime:"2024-03-31 14:30:00",endTime:"",status:"visiting"}]),V=v(1),y=v(10),z=v(100),c=v(!1),N=v(null),r=P({visitorName:"",phone:"",idCard:"",roomNumber:"",guestName:"",visitPurpose:"",duration:1}),D={visitorName:[{required:!0,message:"请输入访客姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号",trigger:"blur"},{pattern:/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,message:"请输入正确的身份证号",trigger:"blur"}],roomNumber:[{required:!0,message:"请输入被访客房号",trigger:"blur"}],guestName:[{required:!0,message:"请验证房间信息",trigger:"change"}],visitPurpose:[{required:!0,message:"请输入访问目的",trigger:"blur"}],duration:[{required:!0,message:"请选择预计时长",trigger:"change"}]},w=()=>{V.value=1,f()},q=()=>{Object.keys(n).forEach(a=>{n[a]=""}),n.visitDate=null,w()},f=async()=>{b.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),b.value=!1}catch(a){console.error("获取访客列表失败:",a),g.error("获取访客列表失败"),b.value=!1}},B=a=>{y.value=a,f()},E=a=>{V.value=a,f()},$=()=>{Object.keys(r).forEach(a=>{r[a]=a==="duration"?1:""}),c.value=!0},h=async()=>{if(!r.roomNumber){g.warning("请输入房间号");return}try{await new Promise(a=>setTimeout(a,1e3)),r.guestName="张三",g.success("房间验证成功")}catch(a){console.error("验证房间失败:",a),g.error("房间验证失败")}},F=async()=>{N.value&&await N.value.validate(async a=>{if(a)try{await new Promise(e=>setTimeout(e,1e3)),g.success("访客登记成功"),c.value=!1,f()}catch(e){console.error("访客登记失败:",e),g.error("访客登记失败")}})},R=async a=>{try{await te.confirm("确定要结束该访客的访问吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await new Promise(e=>setTimeout(e,1e3)),a.status="completed",a.endTime=new Date().toLocaleString(),g.success("访问已结束")}catch(e){e!=="cancel"&&(console.error("结束访问失败:",e),g.error("操作失败"))}},j=a=>{console.log("查看访客详情:",a)};return f(),(a,e)=>{const m=s("el-button"),p=s("el-input"),i=s("el-form-item"),k=s("el-option"),L=s("el-select"),M=s("el-date-picker"),x=s("el-form"),U=s("el-card"),u=s("el-table-column"),O=s("el-tag"),A=s("el-table"),I=s("el-pagination"),X=s("el-input-number"),G=s("el-dialog"),H=Q("loading");return C(),W("div",le,[_("div",oe,[e[16]||(e[16]=_("h2",null,"访客登记",-1)),t(m,{type:"primary",onClick:$},{default:o(()=>e[15]||(e[15]=[d("新增访客")])),_:1})]),t(U,{class:"search-card"},{default:o(()=>[t(x,{inline:!0,model:n,class:"search-form"},{default:o(()=>[t(i,{label:"访客姓名"},{default:o(()=>[t(p,{modelValue:n.visitorName,"onUpdate:modelValue":e[0]||(e[0]=l=>n.visitorName=l),placeholder:"请输入访客姓名",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{label:"被访客房"},{default:o(()=>[t(p,{modelValue:n.roomNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>n.roomNumber=l),placeholder:"请输入房间号",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{label:"访问状态"},{default:o(()=>[t(L,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"请选择状态",clearable:""},{default:o(()=>[t(k,{label:"访问中",value:"visiting"}),t(k,{label:"已结束",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"访问日期"},{default:o(()=>[t(M,{modelValue:n.visitDate,"onUpdate:modelValue":e[3]||(e[3]=l=>n.visitDate=l),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(m,{type:"primary",onClick:w},{default:o(()=>e[17]||(e[17]=[d("搜索")])),_:1}),t(m,{onClick:q},{default:o(()=>e[18]||(e[18]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"list-card"},{default:o(()=>[Y((C(),T(A,{data:S.value,style:{width:"100%"}},{default:o(()=>[t(u,{prop:"visitorName",label:"访客姓名"}),t(u,{prop:"phone",label:"联系电话"}),t(u,{prop:"idCard",label:"身份证号",width:"180"}),t(u,{prop:"roomNumber",label:"被访客房"}),t(u,{prop:"guestName",label:"被访客人"}),t(u,{prop:"visitPurpose",label:"访问目的"}),t(u,{prop:"startTime",label:"到访时间",width:"180"}),t(u,{prop:"endTime",label:"离开时间",width:"180"}),t(u,{prop:"status",label:"状态"},{default:o(({row:l})=>[t(O,{type:l.status==="visiting"?"success":""},{default:o(()=>[d(Z(l.status==="visiting"?"访问中":"已结束"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"操作",width:"150"},{default:o(({row:l})=>[l.status==="visiting"?(C(),T(m,{key:0,type:"primary",link:"",onClick:J=>R(l)},{default:o(()=>e[19]||(e[19]=[d("结束访问")])),_:2},1032,["onClick"])):ee("",!0),t(m,{type:"primary",link:"",onClick:J=>j(l)},{default:o(()=>e[20]||(e[20]=[d("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,b.value]]),_("div",ae,[t(I,{"current-page":V.value,"onUpdate:currentPage":e[4]||(e[4]=l=>V.value=l),"page-size":y.value,"onUpdate:pageSize":e[5]||(e[5]=l=>y.value=l),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),t(G,{title:"访客登记",modelValue:c.value,"onUpdate:modelValue":e[14]||(e[14]=l=>c.value=l),width:"500px"},{footer:o(()=>[_("span",re,[t(m,{onClick:e[13]||(e[13]=l=>c.value=!1)},{default:o(()=>e[23]||(e[23]=[d("取消")])),_:1}),t(m,{type:"primary",onClick:F},{default:o(()=>e[24]||(e[24]=[d("确定")])),_:1})])]),default:o(()=>[t(x,{ref_key:"visitorFormRef",ref:N,model:r,rules:D,"label-width":"100px"},{default:o(()=>[t(i,{label:"访客姓名",prop:"visitorName"},{default:o(()=>[t(p,{modelValue:r.visitorName,"onUpdate:modelValue":e[6]||(e[6]=l=>r.visitorName=l)},null,8,["modelValue"])]),_:1}),t(i,{label:"联系电话",prop:"phone"},{default:o(()=>[t(p,{modelValue:r.phone,"onUpdate:modelValue":e[7]||(e[7]=l=>r.phone=l)},null,8,["modelValue"])]),_:1}),t(i,{label:"身份证号",prop:"idCard"},{default:o(()=>[t(p,{modelValue:r.idCard,"onUpdate:modelValue":e[8]||(e[8]=l=>r.idCard=l)},null,8,["modelValue"])]),_:1}),t(i,{label:"被访客房",prop:"roomNumber"},{default:o(()=>[t(p,{modelValue:r.roomNumber,"onUpdate:modelValue":e[9]||(e[9]=l=>r.roomNumber=l),placeholder:"请输入房间号"},{append:o(()=>[t(m,{onClick:h},{default:o(()=>e[21]||(e[21]=[d("验证")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"被访客人",prop:"guestName"},{default:o(()=>[t(p,{modelValue:r.guestName,"onUpdate:modelValue":e[10]||(e[10]=l=>r.guestName=l),disabled:""},null,8,["modelValue"])]),_:1}),t(i,{label:"访问目的",prop:"visitPurpose"},{default:o(()=>[t(p,{modelValue:r.visitPurpose,"onUpdate:modelValue":e[11]||(e[11]=l=>r.visitPurpose=l),type:"textarea",rows:"3",placeholder:"请输入访问目的"},null,8,["modelValue"])]),_:1}),t(i,{label:"预计时长",prop:"duration"},{default:o(()=>[t(X,{modelValue:r.duration,"onUpdate:modelValue":e[12]||(e[12]=l=>r.duration=l),min:1,max:24,step:.5},null,8,["modelValue"]),e[22]||(e[22]=_("span",{class:"unit-text"},"小时",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ue=K(se,[["__scopeId","data-v-da9ec501"]]);export{ue as default};
