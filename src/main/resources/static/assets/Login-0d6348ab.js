import{_ as L,u as N,z as U,r as v,l as B,m as P,d as i,o as R,c as T,e as o,f as s,w as n,B as q,i as r,p as S,y as E,E as d}from"./index-27530dd5.js";const A={class:"login-container"},C={class:"login-content"},F={class:"remember-forgot"},M={class:"register-link"},z={__name:"Login",setup(G){const g=N(),p=U(),c=v(null),m=v(!1),b=B(),t=P({username:"",password:"",remember:!1}),f=localStorage.getItem("tempUserName");f&&(t.username=f,localStorage.removeItem("tempUserName"));const y={username:[{required:!0,message:"请输入用户名或手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}]},k=async()=>{c.value&&await c.value.validate(async _=>{if(_)try{m.value=!0;const e=await S.login({username:t.username,password:t.password}).catch(l=>{throw console.error("登录请求失败:",l),l});if(e&&e.success&&e.token){b.login({token:e.token,userId:e.userId,username:e.username,role:e.role});try{if(e.userId){const l=await S.getUserInfo(e.userId);l&&l.data&&(localStorage.setItem("userRealName",l.data.name||""),localStorage.setItem("userPhone",l.data.phone||""),localStorage.setItem("userEmail",l.data.email||""),localStorage.setItem("userBirthday",l.data.birthday||""),localStorage.setItem("userGender",l.data.gender||""));const a=await E.getMemberInfo(e.userId);a&&a.data?(localStorage.setItem("userLevel",a.data.level||"普通用户"),localStorage.setItem("userPoints",String(a.data.points||0)),localStorage.setItem("userTotalSpent",String(a.data.totalSpent||0))):(localStorage.setItem("userLevel","普通用户"),localStorage.setItem("userPoints","0"),localStorage.setItem("userTotalSpent","0"))}else localStorage.setItem("userLevel","普通用户"),localStorage.setItem("userPoints","0"),localStorage.setItem("userTotalSpent","0")}catch(l){console.error("获取用户信息失败:",l),localStorage.setItem("userLevel","普通用户"),localStorage.setItem("userPoints","0"),localStorage.setItem("userTotalSpent","0")}d.success("登录成功"),p.query.redirect?g.push(p.query.redirect):g.push("/")}else d.error((e==null?void 0:e.message)||"登录失败，请检查用户名和密码")}catch(e){console.error("登录失败:",e),d.error(e.message||"登录请求出错，请稍后重试")}finally{m.value=!1}})};return(_,e)=>{const l=i("el-input"),a=i("el-form-item"),x=i("el-checkbox"),I=i("router-link"),w=i("el-button"),h=i("el-form"),V=i("el-card");return R(),T("div",A,[e[10]||(e[10]=o("div",{class:"background-image"},null,-1)),o("div",C,[s(V,{class:"login-card luxury-card"},{default:n(()=>[e[8]||(e[8]=o("div",{class:"luxury-header"},[o("div",{class:"logo-wrapper"},[o("img",{src:q,alt:"鹤清酒店",class:"logo"})]),o("h2",{class:"login-title"},"尊贵会员登录"),o("div",{class:"luxury-divider"},[o("span",{class:"divider-icon"})])],-1)),s(h,{model:t,rules:y,ref_key:"loginFormRef",ref:c,"label-width":"0",class:"login-form"},{default:n(()=>[s(a,{prop:"username"},{default:n(()=>[s(l,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=u=>t.username=u),placeholder:"用户名/手机号","prefix-icon":"el-icon-user",class:"luxury-input"},null,8,["modelValue"])]),_:1}),s(a,{prop:"password"},{default:n(()=>[s(l,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=u=>t.password=u),type:"password",placeholder:"密码","prefix-icon":"el-icon-lock","show-password":"",class:"luxury-input"},null,8,["modelValue"])]),_:1}),o("div",F,[s(x,{modelValue:t.remember,"onUpdate:modelValue":e[2]||(e[2]=u=>t.remember=u),class:"luxury-checkbox"},{default:n(()=>e[3]||(e[3]=[r("记住我")])),_:1},8,["modelValue"]),s(I,{to:"/forgot-password",class:"forgot-link luxury-link"},{default:n(()=>e[4]||(e[4]=[r("忘记密码?")])),_:1})]),s(a,null,{default:n(()=>[s(w,{type:"primary",class:"login-btn luxury-btn",onClick:k,loading:m.value},{default:n(()=>e[5]||(e[5]=[r("登录")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o("div",M,[e[7]||(e[7]=r(" 还没有账号? ")),s(I,{to:"/register",class:"luxury-link"},{default:n(()=>e[6]||(e[6]=[r("立即注册")])),_:1})]),e[9]||(e[9]=o("div",{class:"login-benefits luxury-benefits"},[o("h4",null,"会员尊享礼遇"),o("ul",null,[o("li",null,[o("i",{class:"el-icon-check benefit-icon"}),r(" 预订免押金")]),o("li",null,[o("i",{class:"el-icon-check benefit-icon"}),r(" 累计积分兑换免费住宿")]),o("li",null,[o("i",{class:"el-icon-check benefit-icon"}),r(" 专属优惠价格")]),o("li",null,[o("i",{class:"el-icon-check benefit-icon"}),r(" 生日特惠礼遇")]),o("li",null,[o("i",{class:"el-icon-check benefit-icon"}),r(" 会员专享休息室")])])],-1))]),_:1})])])}}},D=L(z,[["__scopeId","data-v-0ef494ae"]]);export{D as default};
